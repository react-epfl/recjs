/**
 * Contains helper functions for tests
 *
 * @extends helper.js
 * hijacked, controller, model
 *
 */

if (!global.GENTLY) {
	global.GENTLY = new (require('gently'))
}

var helper = Helper = require("helper")

// to avoid problem with limited number of listeners
process.setMaxListeners(0)

module.exports = Helper

// interface to global GENTLY object
Helper.hijacked = GENTLY.hijacked

// returns a hijacked object of require based on the path
// ! Don't use absolute paths in require, always use helper.require
Helper.mock = function (path) {
	if (path.match('^/')) {
	  return GENTLY.hijacked[helper.fullPath(path)]	
	}
	return GENTLY.hijacked[path]
}

// loads a required controller
Helper.controller = function (controller) {
	// /home/project/app/controllers/app_controller
	return helper.require("/app/controllers/" + controller + "_controller")
}

// loads a required model
Helper.model = function (app, name) {
	var AppModel = helper.require("/app/models/app_model");
	var Model = helper.require("/app/models/" + name);
	helper.inherits(Model, AppModel);
	Model.app = app;
	Model.prototype.app = app;

	return Model;
}

